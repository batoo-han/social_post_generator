# Архитектура проекта Social Post Generator

## Обзор системы

Social Post Generator - это веб-приложение для автоматической генерации постов для социальных сетей на основе контента веб-сайтов с использованием искусственного интеллекта.

## Основные компоненты

### 1. Backend (Python)

#### 1.1 Модуль OpenAI (`openai_module.py`)
**Назначение:** Взаимодействие с API OpenAI через proxyapi

**Функциональность:**
- Инициализация клиента OpenAI с параметрами из .env
- Отправка запросов к модели GPT
- Обработка ответов
- Управление контекстом и токенами
- Обработка ошибок API

**Основные методы:**
```python
class OpenAIClient:
    - __init__(api_key, base_url, model)
    - generate_text(prompt, max_tokens, temperature)
    - validate_response(response)
```

#### 1.2 Агент генерации постов (`agent.py`)
**Назначение:** Основная бизнес-логика приложения

**Функциональность:**
- Загрузка HTML контента по URL
- Парсинг и очистка текста
- Формирование промптов для разных стилей
- Генерация постов через OpenAI
- Валидация длины результата (до 800 символов)

**Основные методы:**
```python
class SocialPostAgent:
    - __init__(openai_client)
    - fetch_html(url)
    - extract_text(html)
    - clean_text(text)
    - generate_post(url, style)
    - validate_post_length(post)
```

#### 1.3 Веб-сервер (`app.py`)
**Назначение:** REST API и веб-интерфейс

**Технологии:**
- FastAPI - современный веб-фреймворк
- Uvicorn - ASGI сервер
- Pydantic - валидация данных

**Endpoints:**
- `GET /` - веб-интерфейс
- `POST /api/generate` - генерация поста
- `GET /api/health` - проверка здоровья сервиса
- `GET /api/styles` - список доступных стилей

#### 1.4 Модуль логирования (`logger.py`)
**Назначение:** Централизованное логирование

**Уровни логирования:**
- DEBUG - детальная информация для отладки
- INFO - общая информация о работе
- WARNING - предупреждения
- ERROR - ошибки с обработкой
- CRITICAL - критические ошибки

**Функциональность:**
- Ротация логов
- Форматирование с временными метками
- Разделение логов по уровням
- Конфигурация через .env

#### 1.5 Обработка ошибок (`exceptions.py`)
**Назначение:** Кастомные исключения и обработчики

**Типы исключений:**
- `URLFetchError` - ошибка загрузки URL
- `TextExtractionError` - ошибка парсинга текста
- `OpenAIError` - ошибки API OpenAI
- `PostGenerationError` - общие ошибки генерации

### 2. Frontend (HTML/CSS/JavaScript)

#### 2.1 Технологии
- Чистый JavaScript (ES6+)
- CSS3 с анимациями
- Responsive дизайн
- Fetch API для взаимодействия с backend

#### 2.2 Компоненты UI
- Форма ввода URL и выбора стиля
- Кнопка генерации с анимацией загрузки
- Область отображения результата
- Уведомления об ошибках (пользовательские)
- Копирование результата в буфер обмена

#### 2.3 UX фичи
- Плавные анимации появления
- Визуальная обратная связь
- Адаптивный дизайн
- Темная тема
- Прелоадеры

### 3. Инфраструктура

#### 3.1 Docker
**Компоненты:**
- `Dockerfile` - образ приложения
- `docker-compose.yml` - оркестрация
- Многоступенчатая сборка для оптимизации

#### 3.2 Конфигурация
**Файлы:**
- `.env` - секреты и настройки (не в git)
- `.env.example` - шаблон конфигурации
- `config.py` - загрузка конфигурации

**Параметры:**
```
OPENAI_API_KEY - ключ API
OPENAI_BASE_URL - URL proxyapi
OPENAI_MODEL - модель GPT
LOG_LEVEL - уровень логирования
PORT - порт приложения (8082)
```

## Схема взаимодействия компонентов

```
┌─────────────────┐
│   Пользователь  │
└────────┬────────┘
         │ HTTP Request
         ▼
┌─────────────────┐
│   Frontend      │
│  (HTML/JS/CSS)  │
└────────┬────────┘
         │ POST /api/generate
         ▼
┌─────────────────┐
│  FastAPI Server │◄─── Middleware
│    (app.py)     │     (CORS, Logging)
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  SocialPostAgent│
│   (agent.py)    │
└────────┬────────┘
         │
    ┌────┴────┐
    ▼         ▼
┌────────┐ ┌──────────────┐
│ HTML   │ │ OpenAIClient │
│Fetcher │ │(openai_module│
└────────┘ └──────┬───────┘
                  │
                  ▼
           ┌──────────────┐
           │  OpenAI API  │
           │  (proxyapi)  │
           └──────────────┘
```

## Потоки данных

### 1. Генерация поста

```
1. Пользователь вводит URL и стиль
2. Frontend отправляет POST /api/generate
3. FastAPI валидирует запрос
4. Agent.generate_post():
   a. Загружает HTML по URL
   b. Извлекает и очищает текст
   c. Формирует промпт
   d. Отправляет запрос в OpenAI
   e. Получает и валидирует пост
5. Результат возвращается клиенту
6. Frontend отображает пост
```

### 2. Обработка ошибок

```
1. Ошибка возникает на любом этапе
2. Логируется в файл с полными деталями
3. Пользователю возвращается дружественное сообщение
4. Администратор получает уведомление (опционально)
```

## Безопасность

### 1. Защита данных
- API ключи в .env, не в коде
- .env в .gitignore
- Валидация всех входящих данных
- Санитизация URL

### 2. Ограничения
- Rate limiting для API
- Таймауты для HTTP запросов
- Ограничение размера загружаемого HTML
- Валидация URL (белый список протоколов)

### 3. CORS
- Настройка разрешенных источников
- Ограничение методов

## Масштабируемость

### 1. Горизонтальное масштабирование
- Stateless дизайн
- Готовность к работе за load balancer
- Контейнеризация через Docker

### 2. Кэширование (будущее)
- Кэш сгенерированных постов
- TTL для кэша
- Redis для распределенного кэша

### 3. Мониторинг
- Логирование всех операций
- Метрики производительности
- Health check endpoint

## Технологический стек

### Backend
- Python 3.10+
- FastAPI 0.104+
- Uvicorn (ASGI сервер)
- Requests / httpx
- BeautifulSoup4
- python-dotenv
- OpenAI SDK

### Frontend
- HTML5
- CSS3 (Flexbox, Grid, Animations)
- JavaScript ES6+
- Fetch API

### DevOps
- Docker
- Docker Compose
- Git

### Продакшн
- Ubuntu/Debian VPS
- Nginx (reverse proxy) - опционально
- Systemd для управления сервисом
- Certbot для SSL (опционально)

## Требования к окружению

### Разработка
- Python 3.10+
- .venv для изоляции зависимостей
- Cursor IDE с AI агентом

### Продакшн
- VPS с Ubuntu 20.04+
- Docker и Docker Compose
- 1GB+ RAM
- 10GB+ диск

## Развертывание

### 1. Локальная разработка
```bash
python -m venv .venv
.venv\Scripts\activate  # Windows
pip install -r requirements.txt
python app.py
```

### 2. Docker
```bash
docker-compose up -d
```

### 3. VPS
```bash
git clone <repo>
cd social_post_generator
cp .env.example .env
# Настроить .env
docker-compose up -d
```

## Мониторинг и обслуживание

### Логи
- `logs/app.log` - основной лог
- `logs/error.log` - только ошибки
- Ротация логов по размеру/дате

### Health checks
- `GET /api/health` - статус сервиса
- Проверка доступности OpenAI
- Проверка использования памяти

### Обновление
```bash
git pull
docker-compose down
docker-compose build
docker-compose up -d
```

